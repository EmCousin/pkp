<%= form_for [:dashboard, @subscription],
              class: "mt-8 max-w-2xl mx-auto px-4",
              data: { controller: :form } do |f| %>
  <div class="bg-white/95 backdrop-blur-sm rounded-xl shadow-lg border border-gray-100 p-6 sm:p-8 space-y-6 sm:space-y-8 transition-all duration-200 hover:shadow-xl">
    <!-- Member Selection Section -->
    <div class="space-y-4">
      <div class="flex items-center space-x-3 mb-6">
        <div class="w-10 h-10 bg-gradient-to-br from-slate-600 to-slate-800 rounded-full flex items-center justify-center shadow-lg">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-gray-900">Sélection du membre</h3>
          <p class="text-sm text-gray-500">Choisissez le membre pour cette inscription</p>
        </div>
      </div>

      <%= tag.div class: class_names("flex flex-col sm:flex-row sm:items-center gap-4", "animate-fade-in-up" => @subscription.member.blank?) do %>
        <div class="flex-1">
          <%= f.collection_select(:member_id,
                                current_user.members.available,
                                :id,
                                :full_name,
                                { include_blank: false },
                                class: "w-full bg-gray-50 border-2 border-gray-200 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-slate-600 focus:border-slate-600 transition-all duration-200 hover:border-gray-300 focus:-translate-y-1 focus:shadow-lg relative z-10",
                                data: { action: "change->form#submit" }) %>
        </div>

        <% unless @subscription.member %>
          <%= link_to new_dashboard_member_path,
                      class: "inline-flex items-center text-sm text-slate-600 hover:text-slate-800 transition-colors duration-200" do %>
            <svg class="w-4 h-4 mr-1.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            <%= t(".add_member") %>
          <% end %>
        <% end %>
      <% end %>
    </div>

    <% if @subscription.member&.valid? %>
      <!-- Category Selection Section -->
      <%= tag.div class: class_names("space-y-4", "animate-fade-in-up" => @subscription.category.blank?) do %>
        <div class="flex items-center space-x-3 mb-4">
          <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-md">
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
            </svg>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-900">Type de cours</h3>
            <p class="text-sm text-gray-500">Sélectionnez la catégorie de cours</p>
          </div>
        </div>

        <div>
          <%= f.collection_select(:category_id,
                                @subscription.suitable_categories,
                                :id,
                                :title,
                                { include_blank: t('.select_category') },
                                required: true,
                                class: "w-full bg-gray-50 border-2 border-gray-200 rounded-lg px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-all duration-200 hover:border-gray-300 focus:-translate-y-1 focus:shadow-lg relative z-10",
                                data: { action: "change->form#submit" }) %>
        </div>
      <% end %>

      <% if @subscription.category.present? %>
        <% if @subscription.course_ids.any? && @subscription.errors.any? %>
          <div class="rounded-lg bg-red-50 border border-red-200 p-4">
            <div class="flex items-center space-x-2">
              <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <h4 class="text-sm font-medium text-red-800">Erreurs de validation</h4>
            </div>
            <ul class="mt-2 list-disc pl-5 text-sm text-red-700">
              <% @subscription.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <% if @subscription.available_courses.any? %>
          <!-- Course Selection Section -->
          <div class="space-y-4">
            <div class="flex items-center space-x-3 mb-4">
              <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center shadow-md">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-semibold text-gray-900">Cours</h3>
                <p class="text-sm text-gray-500">Sélectionnez les cours souhaités</p>
              </div>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 sm:p-6 space-y-3 border border-gray-100">
              <ul class="mt-2 text-sm">
                <% @subscription.errors.messages_for(:courses).each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>

              <%= f.collection_check_boxes :course_ids, @subscription.available_courses, :id, :title, required: true do |b| %>
                <div class="flex items-start space-x-3 group hover:bg-gray-100 rounded-lg p-2 transition-colors duration-200">
                  <div class="flex-shrink-0 mt-0.5">
                    <%= b.check_box(class: "h-5 w-5 text-slate-600 border-2 border-gray-300 rounded-md focus:ring-2 focus:ring-slate-600 focus:ring-offset-2 transition-all duration-200 appearance-none relative cursor-pointer checked:bg-gradient-to-r checked:from-slate-600 checked:to-slate-700 checked:border-transparent",
                                  disabled: !b.object.available?) %>
                  </div>
                  <div class="flex-1 min-w-0">
                    <%= b.label(class: class_names("text-sm font-medium text-gray-900 cursor-pointer group-hover:text-slate-700 transition-colors duration-200", "line-through text-gray-400" => !b.object.available?)) do %>
                      <%= b.text %>
                      <% unless b.object.available? %>
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 ml-2">
                          <%= t('.full') %>
                        </span>
                      <% end %>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% else %>
          <div class="rounded-lg bg-yellow-50 border border-yellow-200 p-4 sm:p-6">
            <div class="flex items-center space-x-3">
              <svg class="w-6 h-6 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
              </svg>
              <div>
                <h4 class="text-sm font-medium text-yellow-800">Aucun cours disponible</h4>
                <p class="text-sm text-yellow-700 mt-1">
                  <%= t('.no_courses_available', category_title: @subscription.category.title)%>
                </p>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    <% end %>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
      <%= link_to t('defaults.back'),
                  :dashboard,
                  class: "inline-flex justify-center items-center px-6 py-3 border-2 border-gray-300 shadow-sm text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-600 transition-all duration-200 transform hover:scale-105 hover:-translate-y-1 hover:shadow-lg" %>
      <%= f.submit t('defaults.continue'),
                  class: "inline-flex justify-center items-center px-6 py-3 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-600 transition-all duration-200 transform hover:scale-105 hover:-translate-y-1 hover:shadow-lg",
                  data: { form_target: :submit } %>
    </div>
  </div>
<% end %>
