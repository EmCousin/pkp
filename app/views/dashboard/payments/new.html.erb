<div class="w-full max-w-2xl mx-auto px-4 py-8">
  <div class="flex justify-center mb-8">
    <button type="button" id="stripeTab" class="tab-btn active flex-1 py-3 rounded-l-lg text-lg font-semibold bg-slate-800 text-white hover:bg-slate-900 transition">ðŸ’³ Payer par carte bancaire</button>
    <button type="button" id="proofTab" class="tab-btn flex-1 py-3 rounded-r-lg text-lg font-semibold bg-white text-slate-800 border border-l-0 border-slate-200 hover:bg-slate-100 transition">ðŸ“„ Joindre un justificatif</button>
  </div>

  <!-- Stripe Payment Form -->
  <div id="stripeForm" class="tab-content">
    <div class="bg-white rounded-xl shadow-lg p-8 flex flex-col gap-6">
      <%= form_for @subscription,
                   url: dashboard_subscription_payment_path(@subscription.id),
                   method: :post,
                   class: "space-y-4 mt-2",
                   data: {
                     controller: 'form stripe',
                     stripe_target: 'form',
                     stripe_key_value: Rails.application.credentials.stripe[:public_key],
                     stripe_locale_value: I18n.locale
                   } do |f| %>
        <div>
          <label for="card-element" class="block text-sm font-medium text-gray-700 mb-1">
            <%= t('.payment_by_card')%>
          </label>
          <div class="mt-1 p-3 border rounded-md shadow-sm bg-white" data-stripe-target="cardElement">
            <!-- A Stripe Element will be inserted here. -->
          </div>
          <div class="mt-2 text-sm text-red-600" data-stripe-target="cardErrors" role="alert"></div>
        </div>
        <div class="flex flex-col sm:flex-row gap-3 mt-8">
          <%= link_to t('defaults.back'), :dashboard, class: "inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-800" %>
          <%= f.submit t('.pay', amount: number_to_currency(@subscription.fee, unit: "â‚¬", separator: ",", format: "%n %u")),
                       class: "inline-flex justify-center items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-slate-800 hover:bg-slate-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-800",
                       data: { form_target: :submit } %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Payment Proof Upload Form -->
  <div id="proofForm" class="tab-content hidden">
    <div class="bg-white rounded-xl shadow-lg p-8 flex flex-col gap-6">
      <%= form_for @subscription,
                   url: dashboard_subscription_payment_proof_path(@subscription),
                   class: "space-y-4 mt-2",
                   data: { controller: :form } do |form| %>
        <% if form.object.errors.any? %>
          <div class="rounded-md bg-red-50 p-4 mb-6">
            <h2 class="text-lg font-medium text-red-800 mb-2">
              <%= pluralize(form.object.errors.count, "error") %> prohibited this subscription from being saved:
            </h2>
            <ul class="list-disc pl-5 text-sm text-red-700">
              <% form.object.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>
        <div>
          <%= form.label :payment_proof, class: "block text-sm font-medium text-gray-700 mb-1" %>
          <div class="mt-1">
            <%= form.file_field :payment_proof,
                               required: true,
                               class: "block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-slate-800 file:text-white hover:file:bg-slate-900" %>
          </div>
        </div>
        <div class="flex flex-col sm:flex-row gap-3 mt-8">
          <%= link_to t('defaults.back'), :dashboard, class: "inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-800" %>
          <%= form.submit t('defaults.save'), class: "inline-flex justify-center items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-slate-800 hover:bg-slate-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-800", data: { form_target: :submit } %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  // Simple tab toggle logic
  document.addEventListener('DOMContentLoaded', function() {
    const stripeTab = document.getElementById('stripeTab');
    const proofTab = document.getElementById('proofTab');
    const stripeForm = document.getElementById('stripeForm');
    const proofForm = document.getElementById('proofForm');
    function activate(tab, form) {
      stripeTab.classList.remove('bg-slate-800', 'text-white', 'active');
      stripeTab.classList.add('bg-white', 'text-slate-800');
      proofTab.classList.remove('bg-slate-800', 'text-white', 'active');
      proofTab.classList.add('bg-white', 'text-slate-800');
      stripeForm.classList.add('hidden');
      proofForm.classList.add('hidden');
      tab.classList.add('bg-slate-800', 'text-white', 'active');
      tab.classList.remove('bg-white', 'text-slate-800');
      form.classList.remove('hidden');
    }
    stripeTab.addEventListener('click', function() { activate(stripeTab, stripeForm); });
    proofTab.addEventListener('click', function() { activate(proofTab, proofForm); });
  });
</script>

<style>
  /* Optional: for a little extra polish on the tab buttons */
  .tab-btn.active {
    box-shadow: 0 2px 8px 0 rgba(30,41,59,0.10);
    z-index: 1;
  }
</style>
