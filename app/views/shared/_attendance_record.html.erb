<%= turbo_frame_tag dom_id(attendance_record) do %>
  <div class="px-4 py-4">
    <div class="flex items-center justify-between gap-4">
      <%# Member info and status %>
      <div class="flex items-center sm:flex-1 gap-3">
        <% if attendance_record.member.avatar.attached? %>
          <% begin %>
            <%= image_tag attendance_record.member.avatar.variant(:mini), class: "h-12 w-12 rounded-full object-cover" %>
          <% rescue ActiveStorage::InvariableError %>
            <%= image_tag attendance_record.member.avatar, class: "h-12 w-12 rounded-full object-cover" %>
          <% rescue StandardError %>
            <%= image_tag "default_avatar.png", class: "h-12 w-12 rounded-full object-cover" %>
          <% end %>
        <% end %>
        <div class="flex flex-col gap-y-1">
          <div class="font-medium text-gray-900 flex items-center gap-x-2">
            <% if namespace == :admin %>
              <%= link_to attendance_record.member.full_name, [:admin, attendance_record.member], class: "hover:text-gray-600 text-base sm:text-lg", data: { turbo_frame: "_top" } %>
            <% else %>
              <span class="text-base sm:text-lg"><%= attendance_record.member.full_name %></span>
            <% end %>
            <%= tag.span class: class_names("hidden sm:block px-2 py-1 text-xs leading-5 font-semibold rounded-full", AttendanceRecord::STATUS_STYLES[attendance_record.status.to_sym][:color]) do %>
              <%= AttendanceRecord::STATUS_STYLES[attendance_record.status.to_sym][:label] %>
            <% end %>
          </div>
          <div class="flex items-center gap-2 text-sm">
            <div class="w-3 h-3 border border-gray-300 rounded" style="background-color: <%= attendance_record.member.level %>"></div>
            <span class="text-gray-500">
              <%= t("activerecord.attributes.member.levels.#{attendance_record.member.level}") %>
            </span>
          </div>
        </div>
      </div>

      <%# Action button group with icons %>
      <div class="flex-shrink-0">
        <%= form_with model: attendance_record,
                      url: polymorphic_path([namespace, @attendance_sheet, attendance_record]),
                      data: { controller: "form" },
                      class: "flex flex-row" do |f| %>
          <%= f.collection_radio_buttons :status,
                                         AttendanceRecord.statuses.keys,
                                         :itself,
                                         ->(status) { t("activerecord.attributes.attendance_record.statuses.#{status}") },
                                         {},
                                         class: "hidden",
                                         data: { action: "form#submit" } do |b| %>
            <% idx = AttendanceRecord.statuses.keys.index(b.value) %>
            <% total = AttendanceRecord.statuses.keys.size %>
            <% rounded = if idx == 0
              'rounded-l-full'
            elsif idx == total - 1
              'rounded-r-full'
            else
              'rounded-none'
            end %>
            <%= b.radio_button %>
            <%= b.label class: class_names(
              "cursor-pointer flex items-center justify-center border border-gray-300 transition min-w-0 px-3 py-2.5 text-sm font-semibold h-12 sm:px-5 sm:text-base sm:h-auto",
              rounded,
              AttendanceRecord::STATUS_STYLES[b.value.to_sym][:color],
              "border-r-0" => idx == total - 1,
              "opacity-70 filter grayscale" => f.object.status.to_s != b.value.to_s
            ), aria: { label: AttendanceRecord::STATUS_STYLES[b.value.to_sym][:label] } do %>
              <span
                class="flex items-center justify-center text-lg sm:text-2xl"
                title="<%= AttendanceRecord::STATUS_STYLES[b.value.to_sym][:label] %>"
              >
                <%= AttendanceRecord::STATUS_STYLES[b.value.to_sym][:emoji] %>
              </span>
              <span class="hidden sm:inline sm:ml-2">
                <%= AttendanceRecord::STATUS_STYLES[b.value.to_sym][:label] %>
              </span>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
