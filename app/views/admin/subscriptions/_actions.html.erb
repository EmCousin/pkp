<div class="relative">
  <details class="group">
    <summary class="flex cursor-pointer items-center rounded-md px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
      <%= t('defaults.action') %>
      <svg class="ml-2 h-5 w-5 text-white transition-transform group-open:rotate-180" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </summary>
    <div class="absolute right-0 z-10 mt-2 w-56 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 divide-y divide-gray-100">
      <%= link_to t('defaults.view'),
          [:admin, subscription],
          class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",
          data: { turbo_frame: '_top' } %>

      <%= link_to t('defaults.edit'),
          [:edit, :admin, subscription],
          class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",
          data: { turbo_frame: '_top' } %>

      <% if subscription.form.attached? %>
        <%= link_to t('admin.subscriptions.show.download_subscription_form'),
            rails_blob_path(subscription.form),
            class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",
            data: { turbo_frame: '_top' },
            target: '_blank' %>
      <% end %>

      <% Subscription.statuses.each_key do |status| %>
        <%= next if subscription.status == status %>

        <%= button_to t("defaults.mark_as_#{status}"),
            {
              controller: 'admin/statuses',
              action: 'update',
              subscription_id: subscription.id,
              subscription: { status: }
            },
            method: :put,
            class: class_names(
              "w-full text-left px-4 py-2 text-sm hover:bg-gray-50",
              Subscription::STATUS_COLORS[status.to_sym]
            ) %>
      <% end %>

      <% unless subscription.paid? %>
        <% Subscription.payment_methods.each_key do |payment_method| %>
          <%= next if subscription.payment_method == payment_method %>
          <% next if payment_method == 'credit_card' && subscription.payable_by_credit_card? %>

          <%= button_to t("defaults.paid_with_#{payment_method}"),
              {
                controller: 'admin/payments',
                action: 'create',
                subscription_id: subscription.id,
                subscription: { payment_method: }
              },
              class: class_names(
                "w-full text-left px-4 py-2 text-sm hover:bg-gray-50",
                Subscription::PAYMENT_METHOD_COLORS[payment_method.to_sym]
              ) %>
        <% end %>
      <% end %>

      <%= button_to t('defaults.mark_as_not_paid'),
          [:admin, subscription, :payment],
          method: :delete,
          class: "w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-50" if subscription.paid? %>

      <%= button_to t('defaults.destroy'),
          [:admin, subscription],
          method: :delete,
          data: { turbo_frame: '_top', turbo_confirm: t('defaults.are_you_sure') },
          class: "w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-50" %>
    </div>
  </details>
</div>
