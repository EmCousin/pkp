<% total_amount = number_to_euros(@subscription.fee) %>

<div class="flex justify-center items-center min-h-screen bg-gray-100 py-8 print:bg-white print:py-0">
  <div class="w-full max-w-3xl bg-white rounded-xl shadow-lg p-8 print:shadow-none print:border print:rounded-none">
    <div class="flex flex-col md:flex-row md:justify-between md:items-start border-b pb-6 mb-6">
      <div class="flex flex-col items-start space-y-2">
        <%= image_tag "Logo_PKP.webp", class: "h-16 w-auto mb-4" %>
        <div>
          <p class="font-bold text-lg text-gray-800">Parkour Paris</p>
          <p class="text-gray-500 text-sm">ID société : 750 838 609 00014</p>
          <p class="text-gray-500 text-sm">parkour.paris@gmail.com</p>
        </div>
        <div class="mt-4">
          <p class="font-semibold text-gray-700"><%= @subscription.member.full_name %></p>
          <p class="text-gray-500 text-sm"><%= @subscription.member.address %></p>
          <p class="text-gray-500 text-sm"><%= @subscription.member.zip_code %> <%= @subscription.member.city %>, <%= @subscription.member.country %></p>
          <p class="text-gray-500 text-sm"><%= mail_to @subscription.member.email %></p>
          <p class="text-gray-500 text-sm"><%= @subscription.member.phone_number %></p>
        </div>
      </div>
      <div class="mt-8 md:mt-0 text-right space-y-2">
        <h2 class="text-2xl font-bold text-indigo-700">Facture</h2>
        <p class="text-gray-700 font-semibold">#<%= @subscription.year %><%= @subscription.id %></p>
        <p class="text-gray-500 text-sm">Payée le: <%= l(@subscription.paid_at, format: :short) %></p>
        <p class="text-gray-500 text-sm">Date de délivrance : <%= l(Time.current, format: :short) %></p>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm text-gray-700 mb-6">
        <thead>
          <tr class="bg-indigo-50">
            <th class="py-2 px-4 font-semibold text-left">Cours</th>
            <th class="py-2 px-4 font-semibold text-center">Prix</th>
            <th class="py-2 px-4 font-semibold text-center">Quantité</th>
            <th class="py-2 px-4 font-semibold text-center">Total</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b">
            <td class="py-2 px-4"><%= @subscription.description %></td>
            <td class="py-2 px-4 text-center"><%= total_amount %></td>
            <td class="py-2 px-4 text-center">1</td>
            <td class="py-2 px-4 text-center"><%= total_amount %></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="flex flex-col md:flex-row md:justify-end gap-4 mb-8">
      <div class="w-full md:w-1/2">
        <div class="bg-gray-50 rounded-lg p-4 space-y-2">
          <div class="flex justify-between">
            <span class="font-medium">Sous-total :</span>
            <span><%= total_amount %></span>
          </div>
          <div class="flex justify-between">
            <span class="font-medium">Total facture :</span>
            <span><%= total_amount %></span>
          </div>
          <div class="flex justify-between">
            <span class="font-medium">Montant payé :</span>
            <span><%= number_to_euros(@subscription.paid_amount) %></span>
          </div>
          <div class="flex justify-between border-t pt-2">
            <span class="font-bold text-indigo-700">Solde :</span>
            <span class="font-bold text-indigo-700"><%= number_to_euros(@subscription.balance) %></span>
          </div>
        </div>
      </div>
    </div>

    <div class="flex flex-col gap-8 mt-6">
      <!-- Generate Invoice Section -->
      <div class="bg-green-50 rounded-lg p-6 shadow-sm">
        <h3 class="text-lg font-bold text-green-800 mb-2">Générer automatiquement la facture</h3>
        <p class="text-gray-600 mb-4">Cliquez ci-dessous pour générer une facture à partir des informations de l'inscription.</p>
        <div class="flex justify-center">
          <%= button_to t('.generate_invoice') || 'Générer la facture',
                admin_subscription_invoice_path(@subscription.id),
                method: :post,
                class: "inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200 shadow-sm",
                data: { turbo_submits_with: t('.generating') || 'Génération...' } %>
        </div>
      </div>

      <div class="flex items-center justify-center">
        <span class="border-t border-gray-300 w-full"></span>
        <span class="mx-4 text-gray-400 font-semibold">ou</span>
        <span class="border-t border-gray-300 w-full"></span>
      </div>

      <!-- Upload Manual Invoice Section -->
      <div class="bg-blue-50 rounded-lg p-6 shadow-sm">
        <h3 class="text-lg font-bold text-blue-800 mb-2">Téléverser une facture manuelle</h3>
        <p class="text-gray-600 mb-4">Si vous avez déjà une facture, vous pouvez la téléverser ici.</p>
        <%= form_with(model: @subscription, local: true, url: admin_subscription_invoice_path(@subscription.id), html: { class: 'space-y-4' }) do |form| %>
          <div class="flex flex-col gap-4">
            <%= form.file_field :invoice,
                  required: true,
                  class: "block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-l-md file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 file:cursor-pointer cursor-pointer border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                  accept: ".pdf,.jpg,.jpeg,.png" %>

            <div class="flex flex-col sm:flex-row gap-3 sm:justify-start">
              <%= form.submit t('defaults.upload'),
                    class: "inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200 shadow-sm" %>
              <%= link_to t('defaults.back'),
                    admin_subscription_path(@subscription.id),
                    class: "inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200 shadow-sm" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
